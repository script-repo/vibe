<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modular Web App Framework</title>

  <style>
    /* ============================================
       CSS VARIABLES - Easy Theming
       ============================================ */
    :root {
      --primary: #3b82f6;
      --secondary: #8b5cf6;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #1f2937;
      --light: #f3f4f6;
      --text: #111827;
      --text-secondary: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
      --radius: 0.5rem;
      --transition: all 0.2s ease;
    }

    /* ============================================
       RESET & BASE
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: var(--text);
      background: var(--light);
    }

    /* ============================================
       UTILITY CLASSES
       ============================================ */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }

    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-1 { gap: 0.5rem; }
    .gap-2 { gap: 1rem; }
    .gap-4 { gap: 2rem; }

    .text-center { text-align: center; }
    .font-bold { font-weight: 700; }
    .text-sm { font-size: 0.875rem; }
    .text-lg { font-size: 1.125rem; }
    .text-xl { font-size: 1.25rem; }
    .text-2xl { font-size: 1.5rem; }

    .mt-2 { margin-top: 1rem; }
    .mb-2 { margin-bottom: 1rem; }
    .p-2 { padding: 1rem; }
    .p-4 { padding: 2rem; }

    /* ============================================
       MODERN BUTTON SYSTEM
       ============================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 1rem;
      font-weight: 600;
      border-radius: var(--radius);
      border: none;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }
    .btn-primary:hover {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
      background: var(--secondary);
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text);
    }
    .btn-ghost:hover {
      background: var(--light);
    }

    /* ============================================
       CARD SYSTEM
       ============================================ */
    .card {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .card-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .card-body {
      padding: 1.5rem;
    }

    .card-footer {
      padding: 1rem 1.5rem;
      background: var(--light);
      border-top: 1px solid var(--border);
    }

    /* ============================================
       FORM COMPONENTS
       ============================================ */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text);
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 1rem;
      transition: var(--transition);
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* ============================================
       GRADIENT BACKGROUNDS
       ============================================ */
    .gradient-1 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .gradient-2 {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .gradient-3 {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .gradient-animated {
      background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ============================================
       GLASSMORPHISM
       ============================================ */
    .glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    /* ============================================
       LOADING STATES
       ============================================ */
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--light);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: var(--radius);
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* ============================================
       MODAL SYSTEM
       ============================================ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: var(--transition);
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background: white;
      border-radius: var(--radius);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: var(--transition);
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    /* ============================================
       TOAST NOTIFICATIONS
       ============================================ */
    .toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .toast {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      min-width: 300px;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.success { border-left: 4px solid var(--success); }
    .toast.error { border-left: 4px solid var(--danger); }
    .toast.warning { border-left: 4px solid var(--warning); }
    .toast.info { border-left: 4px solid var(--primary); }
  </style>
</head>
<body>
  <div class="toast-container" id="toastContainer"></div>

  <div class="container">
    <h1 class="text-2xl font-bold text-center mt-2 mb-2">Modular Web App Framework</h1>

    <div class="card">
      <div class="card-header">
        <h2 class="text-xl font-bold">Framework Demo</h2>
      </div>
      <div class="card-body">
        <p>This is a modular framework demonstrating all core capabilities.</p>

        <div class="flex gap-2 mt-2">
          <button class="btn btn-primary" onclick="app.showToast('Success!', 'success')">
            Show Toast
          </button>
          <button class="btn btn-secondary" onclick="app.openModal()">
            Open Modal
          </button>
          <button class="btn btn-success" onclick="app.testPlugin()">
            Test Plugin
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Template -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="card-header">
        <h3 class="text-lg font-bold">Modal Title</h3>
      </div>
      <div class="card-body">
        <p>This is a modal dialog. Click outside or press Escape to close.</p>
      </div>
      <div class="card-footer flex justify-between">
        <button class="btn btn-ghost" onclick="app.closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="app.closeModal()">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // CORE FRAMEWORK
    // ============================================

    /**
     * Event Emitter - For pub/sub pattern
     */
    class EventEmitter {
      constructor() {
        this.events = new Map();
      }

      on(event, callback) {
        if (!this.events.has(event)) {
          this.events.set(event, []);
        }
        this.events.get(event).push(callback);
        return () => this.off(event, callback);
      }

      off(event, callback) {
        if (this.events.has(event)) {
          const callbacks = this.events.get(event);
          const index = callbacks.indexOf(callback);
          if (index > -1) callbacks.splice(index, 1);
        }
      }

      emit(event, ...args) {
        if (this.events.has(event)) {
          this.events.get(event).forEach(callback => {
            try {
              callback(...args);
            } catch (error) {
              console.error(`Error in event listener for "${event}":`, error);
            }
          });
        }
      }
    }

    /**
     * Plugin System - For extensibility
     */
    class PluginSystem {
      constructor() {
        this.plugins = new Map();
        this.hooks = new Map();
      }

      register(name, plugin) {
        if (this.plugins.has(name)) {
          console.warn(`Plugin "${name}" already registered`);
          return false;
        }
        this.plugins.set(name, plugin);
        return true;
      }

      enable(name) {
        const plugin = this.plugins.get(name);
        if (plugin && typeof plugin.init === 'function') {
          plugin.init(this.getAPI());
          return true;
        }
        return false;
      }

      getAPI() {
        return {
          addHook: this.addHook.bind(this),
          applyHook: this.applyHook.bind(this),
          getPlugins: () => Array.from(this.plugins.keys())
        };
      }

      addHook(name, callback, priority = 10) {
        if (!this.hooks.has(name)) {
          this.hooks.set(name, []);
        }
        this.hooks.get(name).push({ callback, priority });
        this.hooks.get(name).sort((a, b) => a.priority - b.priority);
      }

      applyHook(name, value, ...args) {
        if (!this.hooks.has(name)) return value;

        let result = value;
        for (const hook of this.hooks.get(name)) {
          result = hook.callback(result, ...args);
        }
        return result;
      }
    }

    /**
     * State Management - Simple reactive state
     */
    class StateManager {
      constructor(initialState = {}) {
        this.state = initialState;
        this.listeners = [];
      }

      getState() {
        return this.state;
      }

      setState(updates) {
        this.state = { ...this.state, ...updates };
        this.notify();
      }

      subscribe(listener) {
        this.listeners.push(listener);
        return () => {
          this.listeners = this.listeners.filter(l => l !== listener);
        };
      }

      notify() {
        this.listeners.forEach(listener => listener(this.state));
      }
    }

    /**
     * HTTP Client - For API requests
     */
    class HttpClient {
      constructor(baseURL = '') {
        this.baseURL = baseURL;
        this.interceptors = [];
      }

      use(interceptor) {
        this.interceptors.push(interceptor);
      }

      async request(url, options = {}) {
        const fullURL = this.baseURL + url;

        // Apply interceptors
        let modifiedOptions = options;
        for (const interceptor of this.interceptors) {
          modifiedOptions = await interceptor(fullURL, modifiedOptions);
        }

        try {
          const response = await fetch(fullURL, modifiedOptions);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          return await response.json();
        } catch (error) {
          console.error('HTTP Request failed:', error);
          throw error;
        }
      }

      get(url, options) {
        return this.request(url, { ...options, method: 'GET' });
      }

      post(url, data, options) {
        return this.request(url, {
          ...options,
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            ...options?.headers
          },
          body: JSON.stringify(data)
        });
      }
    }

    /**
     * UI Utilities
     */
    const UI = {
      /**
       * Toast notifications
       */
      toast(message, type = 'info', duration = 3000) {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
          <span>${message}</span>
          <button onclick="this.parentElement.remove()" style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 1.2rem;">&times;</button>
        `;

        container.appendChild(toast);

        if (duration > 0) {
          setTimeout(() => toast.remove(), duration);
        }

        return toast;
      },

      /**
       * Modal dialog
       */
      modal: {
        open(selector) {
          const overlay = document.querySelector(selector);
          if (overlay) {
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
          }
        },

        close(selector) {
          const overlay = document.querySelector(selector);
          if (overlay) {
            overlay.classList.remove('active');
            document.body.style.overflow = '';
          }
        }
      },

      /**
       * Loading spinner
       */
      showLoading(element) {
        const spinner = document.createElement('div');
        spinner.className = 'spinner';
        spinner.style.margin = '0 auto';
        element.innerHTML = '';
        element.appendChild(spinner);
      },

      /**
       * Debounce utility
       */
      debounce(func, delay) {
        let timeout;
        return (...args) => {
          clearTimeout(timeout);
          timeout = setTimeout(() => func(...args), delay);
        };
      },

      /**
       * Throttle utility
       */
      throttle(func, limit) {
        let inThrottle;
        return (...args) => {
          if (!inThrottle) {
            func(...args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
          }
        };
      }
    };

    // ============================================
    // APPLICATION INSTANCE
    // ============================================

    class ModularApp {
      constructor(config = {}) {
        this.config = config;
        this.events = new EventEmitter();
        this.plugins = new PluginSystem();
        this.state = new StateManager({
          initialized: false,
          user: null,
          theme: 'light'
        });
        this.http = new HttpClient(config.apiBaseURL || '');

        this.init();
      }

      init() {
        // Load plugins
        if (this.config.plugins) {
          this.config.plugins.forEach(plugin => {
            this.plugins.register(plugin.name, plugin);
            this.plugins.enable(plugin.name);
          });
        }

        // Set up event listeners
        this.setupEventListeners();

        // Mark as initialized
        this.state.setState({ initialized: true });
        this.events.emit('app:ready');
      }

      setupEventListeners() {
        // Close modal on outside click
        document.getElementById('modalOverlay')?.addEventListener('click', (e) => {
          if (e.target.id === 'modalOverlay') {
            this.closeModal();
          }
        });

        // Close modal on Escape
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            this.closeModal();
          }
        });
      }

      // Public API
      showToast(message, type) {
        return UI.toast(message, type);
      }

      openModal() {
        UI.modal.open('#modalOverlay');
      }

      closeModal() {
        UI.modal.close('#modalOverlay');
      }

      testPlugin() {
        this.events.emit('plugin:test');
        this.showToast('Plugin event emitted!', 'info');
      }
    }

    // ============================================
    // EXAMPLE PLUGINS
    // ============================================

    const analyticsPlugin = {
      name: 'analytics',

      init(api) {
        console.log('Analytics plugin initialized');

        api.addHook('page:load', (data) => {
          console.log('Page loaded:', data);
          return data;
        });
      }
    };

    const themePlugin = {
      name: 'theme',

      init(api) {
        console.log('Theme plugin initialized');

        // Add theme switching capability
        window.toggleTheme = () => {
          document.body.classList.toggle('dark-theme');
        };
      }
    };

    // ============================================
    // INITIALIZE APPLICATION
    // ============================================

    const app = new ModularApp({
      apiBaseURL: '/api',
      plugins: [analyticsPlugin, themePlugin]
    });

    // Make app globally accessible
    window.app = app;

    // Log when ready
    app.events.on('app:ready', () => {
      console.log('ðŸš€ Modular App Framework Ready!');
      console.log('Available plugins:', app.plugins.getAPI().getPlugins());
    });
  </script>
</body>
</html>
