<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Voice-Controlled Task Manager - Hands-free productivity tool">
    <meta name="theme-color" content="#667eea">
    <title>Voice Task Manager</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVm9pY2UgVGFzayBNYW5hZ2VyIiwic2hvcnRfbmFtZSI6IlZvaWNlVGFza3MiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzFhMjAyYyIsInRoZW1lX2NvbG9yIjoiIzY2N2VlYSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVEkzSWlCb1pXbG5hSlE5SWpFeU55SWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklqNDhjbVZqZENCM2FXUjBhRDBpTVRJM0lpQm9aV2xuYUhROUlqRXlOeUlnWm1sc2JEMGlJelkyTjJWbFlTSXZQanh3WVhSb0lHUTlJazB6TUNBMk1HeG9OamhzTVRnZ01UaGphQzB4T0hZdE1UaGpNQzB4TUNKZ1ptbHNiRDBpSTJabVppSXZQand2YzNablBnPT0iLCJzaXplcyI6IjEyN3gxMjciLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #4ade80;
            --warning: #fbbf24;
            --danger: #f87171;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border: #475569;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        body.light-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #334155;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 20px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
            position: relative;
            z-index: 1;
        }

        .controls-bar {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 20px var(--shadow);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
        }

        .voice-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            flex: 1;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        #voiceBtn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            position: relative;
        }

        #voiceBtn.listening {
            animation: listeningPulse 1.5s ease-in-out infinite;
        }

        @keyframes listeningPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            50% { box-shadow: 0 0 0 15px rgba(102, 126, 234, 0); }
        }

        .visualization-container {
            flex: 1;
            min-width: 200px;
            height: 60px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        #waveform {
            width: 100%;
            height: 100%;
        }

        .transcription-box {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 20px var(--shadow);
            min-height: 100px;
            border: 2px solid var(--border);
        }

        .transcription-label {
            font-size: 0.9em;
            color: var(--text-muted);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .transcription-text {
            font-size: 1.2em;
            color: var(--primary);
            min-height: 40px;
        }

        .interim {
            opacity: 0.6;
            font-style: italic;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 2fr;
            }
            .stats-panel {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .panel-title {
            font-size: 1.4em;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-input-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1em;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .task-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .task-list::-webkit-scrollbar {
            width: 8px;
        }

        .task-list::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .task-item {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px var(--shadow);
        }

        .task-item.completed {
            opacity: 0.6;
            border-left-color: var(--success);
        }

        .task-item.completed .task-name {
            text-decoration: line-through;
        }

        .task-item.priority-high {
            border-left-color: var(--danger);
        }

        .task-item.priority-medium {
            border-left-color: var(--warning);
        }

        .task-item.priority-low {
            border-left-color: var(--success);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .task-name {
            font-weight: 600;
            font-size: 1.1em;
            flex: 1;
        }

        .task-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
            font-size: 0.85em;
        }

        .meta-badge {
            padding: 4px 10px;
            border-radius: 20px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .meta-badge.category {
            background: var(--primary);
            color: white;
        }

        .meta-badge.priority {
            font-weight: 600;
        }

        .meta-badge.priority-high {
            background: var(--danger);
            color: white;
        }

        .meta-badge.priority-medium {
            background: var(--warning);
            color: white;
        }

        .meta-badge.priority-low {
            background: var(--success);
            color: white;
        }

        .meta-badge.overdue {
            background: var(--danger);
            color: white;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .task-actions button {
            padding: 6px 12px;
            font-size: 0.9em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .insights-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .insight-item {
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }

        .insight-icon {
            font-size: 1.2em;
            margin-right: 10px;
        }

        .command-history {
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .command-item {
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 0.9em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .command-text {
            flex: 1;
        }

        .command-time {
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .settings-panel {
            margin-top: 20px;
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-tertiary);
            border: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        .range-value {
            min-width: 40px;
            text-align: right;
            font-weight: 600;
            color: var(--primary);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .help-panel {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .command-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .example-card {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }

        .example-command {
            font-family: monospace;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .example-description {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .keyboard-shortcuts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
        }

        .shortcut-key {
            background: var(--bg-secondary);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
            border: 1px solid var(--border);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px var(--shadow);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-secondary);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 6px 25px var(--shadow);
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 3000;
            border-left: 4px solid var(--success);
            animation: toastIn 0.3s ease;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast.active {
            display: flex;
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 1.2em;
        }

        @media print {
            .controls-bar, .theme-toggle, button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle btn-secondary" id="themeToggle">üåô</button>

    <header>
        <h1>üé§ Voice Task Manager</h1>
        <p class="subtitle">Hands-free productivity powered by your voice</p>
    </header>

    <div class="container">
        <div class="controls-bar">
            <div class="voice-controls">
                <button id="voiceBtn" class="btn-primary" title="Start Voice Recognition">üé§</button>
                <div class="visualization-container">
                    <canvas id="waveform"></canvas>
                </div>
            </div>
            <button id="settingsBtn" class="btn-secondary">‚öôÔ∏è Settings</button>
            <button id="helpBtn" class="btn-secondary">‚ùì Help</button>
            <button id="exportBtn" class="btn-secondary">üì• Export</button>
        </div>

        <div class="transcription-box">
            <div class="transcription-label">Voice Input:</div>
            <div class="transcription-text" id="transcription">Say a command or add a task...</div>
        </div>

        <div class="main-content">
            <div class="panel">
                <div class="panel-title">üìù Quick Add</div>

                <form class="task-input-form" id="taskForm">
                    <input type="text" id="taskNameInput" placeholder="Task name" required>
                    <textarea id="taskDescInput" placeholder="Description (optional)" rows="3"></textarea>

                    <div class="form-row">
                        <select id="taskCategoryInput">
                            <option value="">Category</option>
                            <option value="Work">Work</option>
                            <option value="Personal">Personal</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Health">Health</option>
                            <option value="Learning">Learning</option>
                            <option value="Other">Other</option>
                        </select>

                        <select id="taskPriorityInput">
                            <option value="medium">Medium Priority</option>
                            <option value="high">High Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                    </div>

                    <input type="date" id="taskDueDateInput">

                    <button type="submit" class="btn-success">‚ûï Add Task</button>
                </form>

                <div class="panel-title" style="margin-top: 30px;">üïê Recent Commands</div>
                <div class="command-history" id="commandHistory"></div>
            </div>

            <div class="panel">
                <div class="panel-title">üìã Tasks</div>

                <input type="text" id="searchInput" placeholder="üîç Search tasks..." style="margin-bottom: 15px;">

                <div class="task-filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="active">Active</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>
                    <button class="filter-btn" data-filter="high">High Priority</button>
                    <button class="filter-btn" data-filter="overdue">Overdue</button>
                </div>

                <div class="task-list" id="taskList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div class="empty-state-text">No tasks yet. Add one using voice or the form!</div>
                    </div>
                </div>
            </div>

            <div class="panel stats-panel">
                <div class="panel-title">üìä Statistics</div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTasksCount">0</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeTasksCount">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedTasksCount">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completionRate">0%</div>
                        <div class="stat-label">Completion Rate</div>
                    </div>
                </div>

                <div class="panel-title" style="margin-top: 20px;">üí° Insights</div>
                <div class="insights-list" id="insightsList"></div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <span class="modal-close" id="closeSettings">√ó</span>
            <h2>‚öôÔ∏è Voice Settings</h2>

            <div class="settings-panel">
                <div class="settings-group">
                    <label class="settings-label">Voice</label>
                    <select id="voiceSelect" style="width: 100%;"></select>
                </div>

                <div class="settings-group">
                    <label class="settings-label">Speech Rate</label>
                    <div class="range-container">
                        <input type="range" id="rateRange" min="0.5" max="2" step="0.1" value="1">
                        <span class="range-value" id="rateValue">1.0</span>
                    </div>
                </div>

                <div class="settings-group">
                    <label class="settings-label">Pitch</label>
                    <div class="range-container">
                        <input type="range" id="pitchRange" min="0" max="2" step="0.1" value="1">
                        <span class="range-value" id="pitchValue">1.0</span>
                    </div>
                </div>

                <div class="settings-group">
                    <label class="settings-label">Volume</label>
                    <div class="range-container">
                        <input type="range" id="volumeRange" min="0" max="1" step="0.1" value="1">
                        <span class="range-value" id="volumeValue">1.0</span>
                    </div>
                </div>

                <div class="settings-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="autoListenCheck">
                        <span>Continuous Listening</span>
                    </label>
                </div>

                <div class="settings-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="voiceFeedbackCheck" checked>
                        <span>Voice Feedback</span>
                    </label>
                </div>

                <button class="btn-primary" id="testVoice" style="width: 100%; margin-top: 15px;">
                    üîä Test Voice
                </button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <span class="modal-close" id="closeHelp">√ó</span>
            <h2>‚ùì Help & Commands</h2>

            <h3 style="margin-top: 20px; color: var(--primary);">Voice Commands</h3>
            <div class="command-examples">
                <div class="example-card">
                    <div class="example-command">"Add task [name]"</div>
                    <div class="example-description">Create a new task</div>
                </div>
                <div class="example-card">
                    <div class="example-command">"Complete task [name]"</div>
                    <div class="example-description">Mark task as completed</div>
                </div>
                <div class="example-card">
                    <div class="example-command">"Delete task [name]"</div>
                    <div class="example-description">Remove a task</div>
                </div>
                <div class="example-card">
                    <div class="example-command">"Show all tasks"</div>
                    <div class="example-description">Display all tasks</div>
                </div>
                <div class="example-card">
                    <div class="example-command">"Show completed"</div>
                    <div class="example-description">Show completed tasks</div>
                </div>
                <div class="example-card">
                    <div class="example-command">"Show active"</div>
                    <div class="example-description">Show active tasks</div>
                </div>
                <div class="example-card">
                    <div class="example-command">"Clear completed"</div>
                    <div class="example-description">Delete all completed tasks</div>
                </div>
                <div class="example-card">
                    <div class="example-command">"High priority [task]"</div>
                    <div class="example-description">Add high priority task</div>
                </div>
                <div class="example-card">
                    <div class="example-command">"Search [keyword]"</div>
                    <div class="example-description">Search tasks</div>
                </div>
            </div>

            <h3 style="margin-top: 25px; color: var(--primary);">Keyboard Shortcuts</h3>
            <div class="keyboard-shortcuts">
                <div class="shortcut-item">
                    <span>Toggle Voice</span>
                    <span class="shortcut-key">Space</span>
                </div>
                <div class="shortcut-item">
                    <span>Quick Add</span>
                    <span class="shortcut-key">Ctrl+A</span>
                </div>
                <div class="shortcut-item">
                    <span>Search</span>
                    <span class="shortcut-key">Ctrl+F</span>
                </div>
                <div class="shortcut-item">
                    <span>Settings</span>
                    <span class="shortcut-key">Ctrl+,</span>
                </div>
                <div class="shortcut-item">
                    <span>Help</span>
                    <span class="shortcut-key">Ctrl+H</span>
                </div>
                <div class="shortcut-item">
                    <span>Toggle Theme</span>
                    <span class="shortcut-key">Ctrl+T</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toastIcon">‚úì</span>
        <span id="toastMessage"></span>
    </div>

    <script>
        // Voice Task Manager Application
        class VoiceTaskManager {
            constructor() {
                this.tasks = this.loadTasks();
                this.currentFilter = 'all';
                this.searchQuery = '';
                this.commandHistory = [];
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                this.isListening = false;
                this.audioContext = null;
                this.analyser = null;
                this.dataArray = null;
                this.settings = this.loadSettings();

                this.init();
            }

            init() {
                this.setupVoiceRecognition();
                this.setupEventListeners();
                this.loadVoices();
                this.renderTasks();
                this.updateStats();
                this.updateInsights();
                this.setupWaveform();
                this.setupKeyboardShortcuts();
                this.checkDueDates();

                // Check for due dates every minute
                setInterval(() => this.checkDueDates(), 60000);
            }

            setupVoiceRecognition() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

                if (!SpeechRecognition) {
                    this.showToast('Voice recognition not supported in this browser', 'error');
                    return;
                }

                this.recognition = new SpeechRecognition();
                this.recognition.continuous = false;
                this.recognition.interimResults = true;
                this.recognition.lang = 'en-US';

                this.recognition.onstart = () => {
                    this.isListening = true;
                    document.getElementById('voiceBtn').classList.add('listening');
                    this.updateTranscription('Listening...');
                    this.startAudioVisualization();
                };

                this.recognition.onend = () => {
                    this.isListening = false;
                    document.getElementById('voiceBtn').classList.remove('listening');
                    this.stopAudioVisualization();

                    if (this.settings.autoListen) {
                        setTimeout(() => this.startListening(), 1000);
                    }
                };

                this.recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    if (interimTranscript) {
                        this.updateTranscription(interimTranscript, true);
                    }

                    if (finalTranscript) {
                        this.updateTranscription(finalTranscript);
                        this.processVoiceCommand(finalTranscript);
                    }
                };

                this.recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    if (event.error !== 'no-speech') {
                        this.showToast(`Voice error: ${event.error}`, 'error');
                    }
                };
            }

            setupWaveform() {
                const canvas = document.getElementById('waveform');
                const ctx = canvas.getContext('2d');

                const resizeCanvas = () => {
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                };

                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);

                const drawWaveform = () => {
                    if (!this.isListening || !this.dataArray) {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = getComputedStyle(document.documentElement)
                            .getPropertyValue('--bg-tertiary');
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        return;
                    }

                    this.analyser.getByteTimeDomainData(this.dataArray);

                    ctx.fillStyle = getComputedStyle(document.documentElement)
                        .getPropertyValue('--bg-tertiary');
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    ctx.lineWidth = 2;
                    ctx.strokeStyle = getComputedStyle(document.documentElement)
                        .getPropertyValue('--primary');
                    ctx.beginPath();

                    const sliceWidth = canvas.width / this.dataArray.length;
                    let x = 0;

                    for (let i = 0; i < this.dataArray.length; i++) {
                        const v = this.dataArray[i] / 128.0;
                        const y = v * canvas.height / 2;

                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }

                        x += sliceWidth;
                    }

                    ctx.lineTo(canvas.width, canvas.height / 2);
                    ctx.stroke();

                    requestAnimationFrame(drawWaveform);
                };

                drawWaveform();
                setInterval(drawWaveform, 50);
            }

            async startAudioVisualization() {
                try {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        this.analyser = this.audioContext.createAnalyser();
                        this.analyser.fftSize = 2048;

                        const bufferLength = this.analyser.frequencyBinCount;
                        this.dataArray = new Uint8Array(bufferLength);
                    }

                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    const source = this.audioContext.createMediaStreamSource(stream);
                    source.connect(this.analyser);
                } catch (err) {
                    console.error('Error accessing microphone:', err);
                }
            }

            stopAudioVisualization() {
                // Keep context alive for reuse
            }

            processVoiceCommand(command) {
                const lowerCommand = command.toLowerCase().trim();
                this.addCommandToHistory(command);

                // Add task commands
                if (lowerCommand.startsWith('add task') || lowerCommand.startsWith('add a task') ||
                    lowerCommand.startsWith('create task') || lowerCommand.startsWith('new task')) {
                    const taskName = lowerCommand
                        .replace(/^(add|create|new)\s+(a\s+)?task\s+/i, '')
                        .trim();
                    if (taskName) {
                        const priority = lowerCommand.includes('high priority') ? 'high' :
                                       lowerCommand.includes('low priority') ? 'low' : 'medium';
                        this.addTask({ name: taskName, priority });
                        this.speak(`Added task: ${taskName}`);
                        return;
                    }
                }

                // High priority task
                if (lowerCommand.startsWith('high priority')) {
                    const taskName = lowerCommand.replace(/^high priority\s+/i, '').trim();
                    if (taskName) {
                        this.addTask({ name: taskName, priority: 'high' });
                        this.speak(`Added high priority task: ${taskName}`);
                        return;
                    }
                }

                // Complete task
                if (lowerCommand.startsWith('complete task') || lowerCommand.startsWith('finish task') ||
                    lowerCommand.startsWith('done with')) {
                    const taskName = lowerCommand
                        .replace(/^(complete|finish|done with)\s+(task\s+)?/i, '')
                        .trim();
                    if (taskName) {
                        this.completeTaskByName(taskName);
                        return;
                    }
                }

                // Delete task
                if (lowerCommand.startsWith('delete task') || lowerCommand.startsWith('remove task')) {
                    const taskName = lowerCommand
                        .replace(/^(delete|remove)\s+task\s+/i, '')
                        .trim();
                    if (taskName) {
                        this.deleteTaskByName(taskName);
                        return;
                    }
                }

                // Filter commands
                if (lowerCommand.includes('show all') || lowerCommand.includes('all tasks')) {
                    this.setFilter('all');
                    this.speak('Showing all tasks');
                    return;
                }

                if (lowerCommand.includes('show completed') || lowerCommand.includes('completed tasks')) {
                    this.setFilter('completed');
                    this.speak('Showing completed tasks');
                    return;
                }

                if (lowerCommand.includes('show active') || lowerCommand.includes('active tasks')) {
                    this.setFilter('active');
                    this.speak('Showing active tasks');
                    return;
                }

                if (lowerCommand.includes('show high priority') || lowerCommand.includes('high priority tasks')) {
                    this.setFilter('high');
                    this.speak('Showing high priority tasks');
                    return;
                }

                if (lowerCommand.includes('show overdue') || lowerCommand.includes('overdue tasks')) {
                    this.setFilter('overdue');
                    this.speak('Showing overdue tasks');
                    return;
                }

                // Clear completed
                if (lowerCommand.includes('clear completed') || lowerCommand.includes('delete completed')) {
                    this.clearCompleted();
                    return;
                }

                // Search
                if (lowerCommand.startsWith('search') || lowerCommand.startsWith('find')) {
                    const query = lowerCommand.replace(/^(search|find)\s+(for\s+)?/i, '').trim();
                    if (query) {
                        document.getElementById('searchInput').value = query;
                        this.searchQuery = query;
                        this.renderTasks();
                        this.speak(`Searching for: ${query}`);
                        return;
                    }
                }

                // Read tasks
                if (lowerCommand.includes('read tasks') || lowerCommand.includes('what are my tasks')) {
                    this.readTasks();
                    return;
                }

                // Statistics
                if (lowerCommand.includes('statistics') || lowerCommand.includes('stats') ||
                    lowerCommand.includes('how many tasks')) {
                    this.readStatistics();
                    return;
                }

                // Default: treat as new task
                if (lowerCommand.length > 3) {
                    this.addTask({ name: command });
                    this.speak(`Added task: ${command}`);
                } else {
                    this.speak("I didn't understand that command. Try saying 'add task' followed by the task name.");
                }
            }

            addTask(taskData) {
                const task = {
                    id: Date.now(),
                    name: taskData.name || taskData,
                    description: taskData.description || '',
                    category: taskData.category || '',
                    priority: taskData.priority || 'medium',
                    dueDate: taskData.dueDate || '',
                    completed: false,
                    createdAt: new Date().toISOString()
                };

                this.tasks.unshift(task);
                this.saveTasks();
                this.renderTasks();
                this.updateStats();
                this.updateInsights();
                this.showToast('Task added successfully!');

                // Reset form
                document.getElementById('taskForm').reset();
            }

            completeTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    this.saveTasks();
                    this.renderTasks();
                    this.updateStats();
                    this.updateInsights();

                    const message = task.completed ? 'Task completed!' : 'Task marked as active';
                    this.showToast(message);

                    if (this.settings.voiceFeedback) {
                        this.speak(message);
                    }
                }
            }

            completeTaskByName(name) {
                const task = this.tasks.find(t =>
                    t.name.toLowerCase().includes(name.toLowerCase()) && !t.completed
                );

                if (task) {
                    task.completed = true;
                    this.saveTasks();
                    this.renderTasks();
                    this.updateStats();
                    this.updateInsights();
                    this.speak(`Completed task: ${task.name}`);
                } else {
                    this.speak(`Could not find active task: ${name}`);
                }
            }

            deleteTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task && confirm(`Delete task: ${task.name}?`)) {
                    this.tasks = this.tasks.filter(t => t.id !== id);
                    this.saveTasks();
                    this.renderTasks();
                    this.updateStats();
                    this.updateInsights();
                    this.showToast('Task deleted');
                }
            }

            deleteTaskByName(name) {
                const task = this.tasks.find(t =>
                    t.name.toLowerCase().includes(name.toLowerCase())
                );

                if (task) {
                    this.tasks = this.tasks.filter(t => t.id !== task.id);
                    this.saveTasks();
                    this.renderTasks();
                    this.updateStats();
                    this.updateInsights();
                    this.speak(`Deleted task: ${task.name}`);
                } else {
                    this.speak(`Could not find task: ${name}`);
                }
            }

            clearCompleted() {
                const count = this.tasks.filter(t => t.completed).length;
                if (count === 0) {
                    this.speak('No completed tasks to clear');
                    return;
                }

                if (confirm(`Delete ${count} completed tasks?`)) {
                    this.tasks = this.tasks.filter(t => !t.completed);
                    this.saveTasks();
                    this.renderTasks();
                    this.updateStats();
                    this.updateInsights();
                    this.speak(`Cleared ${count} completed tasks`);
                }
            }

            setFilter(filter) {
                this.currentFilter = filter;
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.filter === filter);
                });
                this.renderTasks();
            }

            getFilteredTasks() {
                let filtered = [...this.tasks];

                // Apply filter
                switch (this.currentFilter) {
                    case 'active':
                        filtered = filtered.filter(t => !t.completed);
                        break;
                    case 'completed':
                        filtered = filtered.filter(t => t.completed);
                        break;
                    case 'high':
                        filtered = filtered.filter(t => t.priority === 'high' && !t.completed);
                        break;
                    case 'overdue':
                        const now = new Date();
                        filtered = filtered.filter(t =>
                            !t.completed && t.dueDate && new Date(t.dueDate) < now
                        );
                        break;
                }

                // Apply search
                if (this.searchQuery) {
                    const query = this.searchQuery.toLowerCase();
                    filtered = filtered.filter(t =>
                        t.name.toLowerCase().includes(query) ||
                        t.description.toLowerCase().includes(query) ||
                        t.category.toLowerCase().includes(query)
                    );
                }

                return filtered;
            }

            renderTasks() {
                const taskList = document.getElementById('taskList');
                const tasks = this.getFilteredTasks();

                if (tasks.length === 0) {
                    taskList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <div class="empty-state-text">No tasks found</div>
                        </div>
                    `;
                    return;
                }

                taskList.innerHTML = tasks.map(task => {
                    const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && !task.completed;

                    return `
                        <div class="task-item ${task.completed ? 'completed' : ''} priority-${task.priority}">
                            <div class="task-header">
                                <div class="task-name">${this.escapeHtml(task.name)}</div>
                            </div>

                            ${task.description ? `<div style="margin-bottom: 10px; color: var(--text-secondary);">${this.escapeHtml(task.description)}</div>` : ''}

                            <div class="task-meta">
                                ${task.category ? `<span class="meta-badge category">${task.category}</span>` : ''}
                                <span class="meta-badge priority-${task.priority}">${task.priority.toUpperCase()}</span>
                                ${task.dueDate ? `<span class="meta-badge ${isOverdue ? 'overdue' : ''}">${isOverdue ? '‚ö†Ô∏è ' : 'üìÖ '}${this.formatDate(task.dueDate)}</span>` : ''}
                                <span class="meta-badge">üïê ${this.formatDateRelative(task.createdAt)}</span>
                            </div>

                            <div class="task-actions">
                                <button class="btn-${task.completed ? 'secondary' : 'success'}" onclick="app.completeTask(${task.id})">
                                    ${task.completed ? '‚Ü©Ô∏è Undo' : '‚úì Complete'}
                                </button>
                                <button class="btn-danger" onclick="app.deleteTask(${task.id})">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            updateStats() {
                const total = this.tasks.length;
                const completed = this.tasks.filter(t => t.completed).length;
                const active = total - completed;
                const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

                document.getElementById('totalTasksCount').textContent = total;
                document.getElementById('activeTasksCount').textContent = active;
                document.getElementById('completedTasksCount').textContent = completed;
                document.getElementById('completionRate').textContent = `${completionRate}%`;
            }

            updateInsights() {
                const insights = [];
                const now = new Date();

                // Overdue tasks
                const overdue = this.tasks.filter(t =>
                    !t.completed && t.dueDate && new Date(t.dueDate) < now
                ).length;
                if (overdue > 0) {
                    insights.push({
                        icon: '‚ö†Ô∏è',
                        text: `You have ${overdue} overdue task${overdue > 1 ? 's' : ''}`
                    });
                }

                // High priority tasks
                const highPriority = this.tasks.filter(t =>
                    !t.completed && t.priority === 'high'
                ).length;
                if (highPriority > 0) {
                    insights.push({
                        icon: 'üî•',
                        text: `${highPriority} high priority task${highPriority > 1 ? 's' : ''} pending`
                    });
                }

                // Due today
                const today = new Date().toDateString();
                const dueToday = this.tasks.filter(t =>
                    !t.completed && t.dueDate && new Date(t.dueDate).toDateString() === today
                ).length;
                if (dueToday > 0) {
                    insights.push({
                        icon: 'üìÖ',
                        text: `${dueToday} task${dueToday > 1 ? 's' : ''} due today`
                    });
                }

                // Productivity streak
                const recentlyCompleted = this.tasks.filter(t => {
                    if (!t.completed) return false;
                    const completedDate = new Date(t.createdAt);
                    const daysDiff = Math.floor((now - completedDate) / (1000 * 60 * 60 * 24));
                    return daysDiff <= 7;
                }).length;

                if (recentlyCompleted > 5) {
                    insights.push({
                        icon: 'üî•',
                        text: `Great work! ${recentlyCompleted} tasks completed this week`
                    });
                }

                // Most common category
                const categories = {};
                this.tasks.filter(t => !t.completed && t.category).forEach(t => {
                    categories[t.category] = (categories[t.category] || 0) + 1;
                });
                const topCategory = Object.entries(categories).sort((a, b) => b[1] - a[1])[0];
                if (topCategory) {
                    insights.push({
                        icon: 'üìä',
                        text: `Most tasks in: ${topCategory[0]} (${topCategory[1]})`
                    });
                }

                const insightsList = document.getElementById('insightsList');
                if (insights.length === 0) {
                    insightsList.innerHTML = '<div class="insight-item">‚ú® All caught up! Keep up the great work.</div>';
                } else {
                    insightsList.innerHTML = insights.map(insight => `
                        <div class="insight-item">
                            <span class="insight-icon">${insight.icon}</span>
                            ${insight.text}
                        </div>
                    `).join('');
                }
            }

            addCommandToHistory(command) {
                const historyItem = {
                    command,
                    timestamp: new Date()
                };

                this.commandHistory.unshift(historyItem);
                if (this.commandHistory.length > 10) {
                    this.commandHistory.pop();
                }

                this.renderCommandHistory();
            }

            renderCommandHistory() {
                const historyContainer = document.getElementById('commandHistory');

                if (this.commandHistory.length === 0) {
                    historyContainer.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">No commands yet</div>';
                    return;
                }

                historyContainer.innerHTML = this.commandHistory.map(item => `
                    <div class="command-item">
                        <span class="command-text">${this.escapeHtml(item.command)}</span>
                        <span class="command-time">${this.formatTime(item.timestamp)}</span>
                    </div>
                `).join('');
            }

            checkDueDates() {
                const now = new Date();
                this.tasks.forEach(task => {
                    if (!task.completed && task.dueDate && !task.reminderShown) {
                        const dueDate = new Date(task.dueDate);
                        const hoursDiff = (dueDate - now) / (1000 * 60 * 60);

                        // Remind 1 hour before
                        if (hoursDiff > 0 && hoursDiff <= 1) {
                            this.showToast(`Reminder: "${task.name}" is due soon!`, 'warning');
                            this.speak(`Reminder: ${task.name} is due soon`);
                            task.reminderShown = true;
                            this.saveTasks();
                        }
                    }
                });
            }

            readTasks() {
                const activeTasks = this.tasks.filter(t => !t.completed);

                if (activeTasks.length === 0) {
                    this.speak('You have no active tasks. Great job!');
                    return;
                }

                let message = `You have ${activeTasks.length} active task${activeTasks.length > 1 ? 's' : ''}. `;

                activeTasks.slice(0, 5).forEach((task, index) => {
                    message += `${index + 1}. ${task.name}. `;
                });

                if (activeTasks.length > 5) {
                    message += `And ${activeTasks.length - 5} more tasks.`;
                }

                this.speak(message);
            }

            readStatistics() {
                const total = this.tasks.length;
                const completed = this.tasks.filter(t => t.completed).length;
                const active = total - completed;

                const message = `You have ${total} total tasks. ${active} active and ${completed} completed.`;
                this.speak(message);
            }

            speak(text) {
                if (!this.settings.voiceFeedback) return;

                // Cancel any ongoing speech
                this.synthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = this.settings.rate;
                utterance.pitch = this.settings.pitch;
                utterance.volume = this.settings.volume;

                if (this.settings.selectedVoice) {
                    const voices = this.synthesis.getVoices();
                    const voice = voices.find(v => v.name === this.settings.selectedVoice);
                    if (voice) utterance.voice = voice;
                }

                this.synthesis.speak(utterance);
            }

            loadVoices() {
                const voiceSelect = document.getElementById('voiceSelect');

                const populateVoices = () => {
                    const voices = this.synthesis.getVoices();
                    voiceSelect.innerHTML = voices.map(voice =>
                        `<option value="${voice.name}" ${voice.name === this.settings.selectedVoice ? 'selected' : ''}>
                            ${voice.name} (${voice.lang})
                        </option>`
                    ).join('');
                };

                populateVoices();
                this.synthesis.onvoiceschanged = populateVoices;
            }

            updateTranscription(text, isInterim = false) {
                const transcriptionEl = document.getElementById('transcription');
                transcriptionEl.innerHTML = `<span class="${isInterim ? 'interim' : ''}">${this.escapeHtml(text)}</span>`;
            }

            startListening() {
                if (this.isListening) {
                    this.recognition.stop();
                } else {
                    try {
                        this.recognition.start();
                    } catch (err) {
                        console.error('Error starting recognition:', err);
                    }
                }
            }

            exportTasks() {
                const data = {
                    tasks: this.tasks,
                    exportDate: new Date().toISOString(),
                    stats: {
                        total: this.tasks.length,
                        completed: this.tasks.filter(t => t.completed).length,
                        active: this.tasks.filter(t => !t.completed).length
                    }
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tasks-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                this.showToast('Tasks exported successfully!');
            }

            setupEventListeners() {
                // Voice button
                document.getElementById('voiceBtn').addEventListener('click', () => this.startListening());

                // Task form
                document.getElementById('taskForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const taskData = {
                        name: document.getElementById('taskNameInput').value,
                        description: document.getElementById('taskDescInput').value,
                        category: document.getElementById('taskCategoryInput').value,
                        priority: document.getElementById('taskPriorityInput').value,
                        dueDate: document.getElementById('taskDueDateInput').value
                    };
                    this.addTask(taskData);
                });

                // Search
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.searchQuery = e.target.value;
                    this.renderTasks();
                });

                // Filters
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.setFilter(btn.dataset.filter));
                });

                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => {
                    document.body.classList.toggle('light-mode');
                    const icon = document.getElementById('themeToggle');
                    icon.textContent = document.body.classList.contains('light-mode') ? '‚òÄÔ∏è' : 'üåô';
                    localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
                });

                // Load saved theme
                if (localStorage.getItem('theme') === 'light') {
                    document.body.classList.add('light-mode');
                    document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
                }

                // Export
                document.getElementById('exportBtn').addEventListener('click', () => this.exportTasks());

                // Settings modal
                document.getElementById('settingsBtn').addEventListener('click', () => {
                    document.getElementById('settingsModal').classList.add('active');
                });

                document.getElementById('closeSettings').addEventListener('click', () => {
                    document.getElementById('settingsModal').classList.remove('active');
                });

                // Help modal
                document.getElementById('helpBtn').addEventListener('click', () => {
                    document.getElementById('helpModal').classList.add('active');
                });

                document.getElementById('closeHelp').addEventListener('click', () => {
                    document.getElementById('helpModal').classList.remove('active');
                });

                // Close modals on outside click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('active');
                        }
                    });
                });

                // Voice settings
                document.getElementById('voiceSelect').addEventListener('change', (e) => {
                    this.settings.selectedVoice = e.target.value;
                    this.saveSettings();
                });

                document.getElementById('rateRange').addEventListener('input', (e) => {
                    this.settings.rate = parseFloat(e.target.value);
                    document.getElementById('rateValue').textContent = e.target.value;
                    this.saveSettings();
                });

                document.getElementById('pitchRange').addEventListener('input', (e) => {
                    this.settings.pitch = parseFloat(e.target.value);
                    document.getElementById('pitchValue').textContent = e.target.value;
                    this.saveSettings();
                });

                document.getElementById('volumeRange').addEventListener('input', (e) => {
                    this.settings.volume = parseFloat(e.target.value);
                    document.getElementById('volumeValue').textContent = e.target.value;
                    this.saveSettings();
                });

                document.getElementById('autoListenCheck').addEventListener('change', (e) => {
                    this.settings.autoListen = e.target.checked;
                    this.saveSettings();
                });

                document.getElementById('voiceFeedbackCheck').addEventListener('change', (e) => {
                    this.settings.voiceFeedback = e.target.checked;
                    this.saveSettings();
                });

                document.getElementById('testVoice').addEventListener('click', () => {
                    this.speak('This is a test of the voice synthesis settings. How does it sound?');
                });

                // Load settings into UI
                document.getElementById('rateRange').value = this.settings.rate;
                document.getElementById('rateValue').textContent = this.settings.rate;
                document.getElementById('pitchRange').value = this.settings.pitch;
                document.getElementById('pitchValue').textContent = this.settings.pitch;
                document.getElementById('volumeRange').value = this.settings.volume;
                document.getElementById('volumeValue').textContent = this.settings.volume;
                document.getElementById('autoListenCheck').checked = this.settings.autoListen;
                document.getElementById('voiceFeedbackCheck').checked = this.settings.voiceFeedback;
            }

            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Space - toggle voice (when not in input)
                    if (e.code === 'Space' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                        e.preventDefault();
                        this.startListening();
                    }

                    // Ctrl+A - focus add task
                    if (e.ctrlKey && e.key === 'a') {
                        e.preventDefault();
                        document.getElementById('taskNameInput').focus();
                    }

                    // Ctrl+F - focus search
                    if (e.ctrlKey && e.key === 'f') {
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                    }

                    // Ctrl+, - settings
                    if (e.ctrlKey && e.key === ',') {
                        e.preventDefault();
                        document.getElementById('settingsModal').classList.add('active');
                    }

                    // Ctrl+H - help
                    if (e.ctrlKey && e.key === 'h') {
                        e.preventDefault();
                        document.getElementById('helpModal').classList.add('active');
                    }

                    // Ctrl+T - toggle theme
                    if (e.ctrlKey && e.key === 't') {
                        e.preventDefault();
                        document.getElementById('themeToggle').click();
                    }

                    // Escape - close modals
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal').forEach(modal => {
                            modal.classList.remove('active');
                        });
                    }
                });
            }

            showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toastMessage');
                const toastIcon = document.getElementById('toastIcon');

                toast.className = `toast ${type}`;
                toastMessage.textContent = message;

                switch (type) {
                    case 'error':
                        toastIcon.textContent = '‚úó';
                        break;
                    case 'warning':
                        toastIcon.textContent = '‚ö†';
                        break;
                    default:
                        toastIcon.textContent = '‚úì';
                }

                toast.classList.add('active');

                setTimeout(() => {
                    toast.classList.remove('active');
                }, 3000);
            }

            loadTasks() {
                const saved = localStorage.getItem('voiceTasks');
                return saved ? JSON.parse(saved) : [];
            }

            saveTasks() {
                localStorage.setItem('voiceTasks', JSON.stringify(this.tasks));
            }

            loadSettings() {
                const defaults = {
                    rate: 1.0,
                    pitch: 1.0,
                    volume: 1.0,
                    selectedVoice: null,
                    autoListen: false,
                    voiceFeedback: true
                };

                const saved = localStorage.getItem('voiceSettings');
                return saved ? { ...defaults, ...JSON.parse(saved) } : defaults;
            }

            saveSettings() {
                localStorage.setItem('voiceSettings', JSON.stringify(this.settings));
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }

            formatDateRelative(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) return 'just now';
                if (diffMins < 60) return `${diffMins}m ago`;
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffDays < 7) return `${diffDays}d ago`;
                return date.toLocaleDateString();
            }

            formatTime(date) {
                return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            }
        }

        // Initialize app
        const app = new VoiceTaskManager();

        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'voice-tasks-v1';
                    const urlsToCache = ['/'];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;

                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);

                navigator.serviceWorker.register(swUrl)
                    .then(() => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>