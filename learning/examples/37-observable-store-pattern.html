<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observable Store Pattern</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: white; text-align: center; margin-bottom: 30px; }
        .panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .state-display {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            margin: 15px 0;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #5568d3; }
        .counter { font-size: 48px; font-weight: bold; color: #667eea; text-align: center; margin: 20px 0; }
        .todos { list-style: none; }
        .todo-item {
            background: #f9fafb;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .todo-item.completed { opacity: 0.6; text-decoration: line-through; }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Observable Store Pattern</h1>

        <div class="panel">
            <h2>Counter Store (~20 lines of code)</h2>
            <div class="counter" id="counter">0</div>
            <div style="text-align: center;">
                <button onclick="increment()">Increment</button>
                <button onclick="decrement()">Decrement</button>
                <button onclick="reset()">Reset</button>
            </div>
        </div>

        <div class="panel">
            <h2>Todo Store (Shared State)</h2>
            <input type="text" id="todoInput" placeholder="Enter a todo..." onkeypress="if(event.key==='Enter') addTodo()">
            <button onclick="addTodo()">Add Todo</button>
            <ul class="todos" id="todoList"></ul>
        </div>

        <div class="panel">
            <h2>State Snapshot</h2>
            <div class="state-display" id="stateDisplay"></div>
        </div>
    </div>

    <script>
        // Observable Store Implementation (~20 lines)
        function createStore(initialState) {
            let state = initialState;
            const listeners = [];

            return {
                getState() {
                    return state;
                },

                setState(newState) {
                    state = { ...state, ...newState };
                    listeners.forEach(listener => listener(state));
                },

                subscribe(listener) {
                    listeners.push(listener);
                    listener(state); // Call immediately with current state

                    // Return unsubscribe function
                    return () => {
                        const index = listeners.indexOf(listener);
                        if (index > -1) listeners.splice(index, 1);
                    };
                }
            };
        }

        // Create stores
        const counterStore = createStore({ count: 0 });

        const todoStore = createStore({
            todos: [],
            filter: 'all'
        });

        // Subscribe to counter store
        counterStore.subscribe((state) => {
            document.getElementById('counter').textContent = state.count;
            updateStateDisplay();
        });

        // Subscribe to todo store
        todoStore.subscribe((state) => {
            renderTodos(state.todos);
            updateStateDisplay();
        });

        // Counter actions
        function increment() {
            const { count } = counterStore.getState();
            counterStore.setState({ count: count + 1 });
        }

        function decrement() {
            const { count } = counterStore.getState();
            counterStore.setState({ count: count - 1 });
        }

        function reset() {
            counterStore.setState({ count: 0 });
        }

        // Todo actions
        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();

            if (!text) return;

            const { todos } = todoStore.getState();
            const newTodo = {
                id: Date.now(),
                text,
                completed: false
            };

            todoStore.setState({
                todos: [...todos, newTodo]
            });

            input.value = '';
        }

        function toggleTodo(id) {
            const { todos } = todoStore.getState();
            const updatedTodos = todos.map(todo =>
                todo.id === id ? { ...todo, completed: !todo.completed } : todo
            );

            todoStore.setState({ todos: updatedTodos });
        }

        function deleteTodo(id) {
            const { todos } = todoStore.getState();
            const updatedTodos = todos.filter(todo => todo.id !== id);

            todoStore.setState({ todos: updatedTodos });
        }

        function renderTodos(todos) {
            const list = document.getElementById('todoList');
            list.innerHTML = '';

            todos.forEach(todo => {
                const li = document.createElement('li');
                li.className = `todo-item ${todo.completed ? 'completed' : ''}`;

                li.innerHTML = `
                    <span onclick="toggleTodo(${todo.id})" style="cursor: pointer; flex: 1;">
                        ${todo.text}
                    </span>
                    <button onclick="deleteTodo(${todo.id})" style="padding: 6px 12px; font-size: 12px;">
                        Delete
                    </button>
                `;

                list.appendChild(li);
            });
        }

        function updateStateDisplay() {
            const display = document.getElementById('stateDisplay');
            const allState = {
                counter: counterStore.getState(),
                todos: todoStore.getState()
            };

            display.textContent = JSON.stringify(allState, null, 2);
        }

        // Initial render
        updateStateDisplay();
    </script>
</body>
</html>
