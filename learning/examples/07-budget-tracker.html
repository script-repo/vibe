<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker with AI Insights</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.3);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.3);
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .currency-selector {
            padding: 8px 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .currency-selector:hover {
            border-color: var(--primary);
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .theme-toggle {
            width: 50px;
            height: 26px;
            background: var(--bg-tertiary);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .theme-toggle::before {
            content: 'ðŸŒž';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 1px;
            left: 2px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        [data-theme="dark"] .theme-toggle {
            background: var(--primary);
        }

        [data-theme="dark"] .theme-toggle::before {
            content: 'ðŸŒ™';
            left: 24px;
            background: var(--bg-primary);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px var(--shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px var(--shadow);
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .card-value.positive {
            color: var(--success);
        }

        .card-value.negative {
            color: var(--danger);
        }

        .card-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .trend {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .trend.up {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .trend.down {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab:hover {
            color: var(--primary);
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-group input,
        .filter-group select {
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .transaction-list::-webkit-scrollbar {
            width: 8px;
        }

        .transaction-list::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .transaction-list::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .transaction-list::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .transaction-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .transaction-item:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .transaction-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            flex-shrink: 0;
        }

        .transaction-icon.income {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.2));
        }

        .transaction-icon.expense {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.2));
        }

        .transaction-details {
            flex: 1;
            min-width: 0;
        }

        .transaction-category {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 3px;
        }

        .transaction-description {
            font-size: 13px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 16px;
            margin-right: 10px;
        }

        .transaction-amount.income {
            color: var(--success);
        }

        .transaction-amount.expense {
            color: var(--danger);
        }

        .transaction-date {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: right;
        }

        .transaction-actions {
            display: flex;
            gap: 5px;
        }

        .transaction-actions button {
            padding: 6px 10px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .transaction-actions button:hover {
            background: var(--bg-tertiary);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            font-size: 24px;
            font-weight: 700;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .category-item {
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }

        .category-item:hover,
        .category-item.selected {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .category-item .icon {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .category-item .name {
            font-size: 12px;
            font-weight: 600;
        }

        .insights-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .insight-card {
            padding: 15px;
            background: var(--bg-primary);
            border-left: 4px solid var(--primary);
            border-radius: 10px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .insight-card.warning {
            border-left-color: var(--warning);
        }

        .insight-card.success {
            border-left-color: var(--success);
        }

        .insight-card.danger {
            border-left-color: var(--danger);
        }

        .insight-card h4 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insight-card p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .health-score {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 20px auto;
        }

        .health-score-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: 700;
        }

        .health-score-label {
            position: absolute;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .goals-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .goal-item {
            padding: 15px;
            background: var(--bg-primary);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-name {
            font-weight: 600;
            font-size: 15px;
        }

        .goal-amount {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .goal-progress {
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .goal-percentage {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: right;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 20px;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-recurring {
            background: rgba(139, 92, 246, 0.2);
            color: var(--secondary);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: var(--warning);
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--danger);
        }

        .alert-icon {
            font-size: 20px;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .alert-message {
            font-size: 13px;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .main-content {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ðŸ’° Budget Tracker</h1>
            <div class="header-controls">
                <select class="currency-selector" id="currencySelect">
                    <option value="USD">USD ($)</option>
                    <option value="EUR">EUR (â‚¬)</option>
                    <option value="GBP">GBP (Â£)</option>
                    <option value="JPY">JPY (Â¥)</option>
                    <option value="INR">INR (â‚¹)</option>
                    <option value="CAD">CAD ($)</option>
                    <option value="AUD">AUD ($)</option>
                </select>
                <button class="btn btn-success" onclick="app.openTransactionModal()">+ Add Transaction</button>
                <button class="btn btn-secondary" onclick="app.openGoalModal()">ðŸŽ¯ Goals</button>
                <button class="btn btn-secondary" onclick="app.exportToCSV()">ðŸ“¥ Export</button>
                <div class="theme-toggle" onclick="app.toggleTheme()"></div>
            </div>
        </div>

        <!-- Alerts -->
        <div id="alertsContainer"></div>

        <!-- Dashboard Stats -->
        <div class="dashboard">
            <div class="card">
                <div class="card-title">Total Balance</div>
                <div class="card-value" id="totalBalance">$0.00</div>
                <div class="card-subtitle">
                    <span id="balanceTrend"></span>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Income (This Month)</div>
                <div class="card-value positive" id="monthlyIncome">$0.00</div>
                <div class="card-subtitle">
                    <span id="incomeTrend"></span>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Expenses (This Month)</div>
                <div class="card-value negative" id="monthlyExpenses">$0.00</div>
                <div class="card-subtitle">
                    <span id="expensesTrend"></span>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Financial Health</div>
                <div class="card-value" id="healthScore" style="color: var(--primary);">--</div>
                <div class="card-subtitle" id="healthLabel">Calculating...</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div class="card">
                <div class="tabs">
                    <button class="tab active" data-tab="transactions" onclick="app.switchTab('transactions')">Transactions</button>
                    <button class="tab" data-tab="analytics" onclick="app.switchTab('analytics')">Analytics</button>
                    <button class="tab" data-tab="budget" onclick="app.switchTab('budget')">Budget</button>
                </div>

                <!-- Transactions Tab -->
                <div id="transactionsTab" class="tab-content">
                    <div class="filters">
                        <div class="filter-group">
                            <label>Search</label>
                            <input type="text" id="searchInput" placeholder="Search transactions..." onkeyup="app.filterTransactions()">
                        </div>
                        <div class="filter-group">
                            <label>Category</label>
                            <select id="categoryFilter" onchange="app.filterTransactions()">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Type</label>
                            <select id="typeFilter" onchange="app.filterTransactions()">
                                <option value="">All Types</option>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Period</label>
                            <select id="periodFilter" onchange="app.filterTransactions()">
                                <option value="all">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month" selected>This Month</option>
                                <option value="year">This Year</option>
                            </select>
                        </div>
                    </div>
                    <div class="transaction-list" id="transactionList"></div>
                </div>

                <!-- Analytics Tab -->
                <div id="analyticsTab" class="tab-content" style="display: none;">
                    <h3 style="margin-bottom: 15px;">Spending by Category</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart" class="chart-canvas"></canvas>
                    </div>
                    <div id="categoryLegend" class="legend"></div>

                    <h3 style="margin: 30px 0 15px;">Monthly Trend</h3>
                    <div class="chart-container">
                        <canvas id="trendChart" class="chart-canvas"></canvas>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="avgDailySpending">$0</div>
                            <div class="stat-label">Avg Daily Spending</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="largestExpense">$0</div>
                            <div class="stat-label">Largest Expense</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="transactionCount">0</div>
                            <div class="stat-label">Total Transactions</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="topCategory">--</div>
                            <div class="stat-label">Top Category</div>
                        </div>
                    </div>
                </div>

                <!-- Budget Tab -->
                <div id="budgetTab" class="tab-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Budget Overview</h3>
                        <button class="btn btn-primary btn-sm" onclick="app.openBudgetModal()">Set Budget</button>
                    </div>
                    <div id="budgetList"></div>
                </div>
            </div>

            <!-- Right Panel -->
            <div>
                <!-- AI Insights -->
                <div class="card">
                    <div class="card-title">ðŸ¤– AI Insights</div>
                    <div class="insights-panel" id="insightsPanel"></div>
                </div>

                <!-- Savings Goals -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-title">ðŸŽ¯ Savings Goals</div>
                    <div class="goals-list" id="goalsList"></div>
                    <button class="btn btn-primary btn-sm" style="width: 100%; margin-top: 15px;" onclick="app.openGoalModal()">+ Add Goal</button>
                </div>

                <!-- Predictions -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-title">ðŸ“Š Predictions</div>
                    <div id="predictionsPanel"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="transactionModalTitle">Add Transaction</h2>
                <button class="modal-close" onclick="app.closeTransactionModal()">Ã—</button>
            </div>
            <form id="transactionForm" onsubmit="app.saveTransaction(event)">
                <input type="hidden" id="transactionId">

                <div class="form-group">
                    <label>Type</label>
                    <div style="display: flex; gap: 10px;">
                        <label style="flex: 1; display: flex; align-items: center; padding: 12px; border: 2px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" class="type-option">
                            <input type="radio" name="type" value="expense" checked onchange="app.updateCategoryOptions()" style="margin-right: 10px;">
                            <span>ðŸ’¸ Expense</span>
                        </label>
                        <label style="flex: 1; display: flex; align-items: center; padding: 12px; border: 2px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" class="type-option">
                            <input type="radio" name="type" value="income" onchange="app.updateCategoryOptions()" style="margin-right: 10px;">
                            <span>ðŸ’° Income</span>
                        </label>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Amount *</label>
                        <input type="number" id="transactionAmount" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="transactionDate" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Category *</label>
                    <div class="category-grid" id="categoryGrid"></div>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="transactionDescription" placeholder="e.g., Grocery shopping">
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="transactionNotes" placeholder="Add receipt details or additional notes..."></textarea>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="transactionRecurring" style="margin-right: 10px;">
                        <span>Recurring Transaction</span>
                    </label>
                </div>

                <div id="recurringOptions" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Frequency</label>
                            <select id="recurringFrequency">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly" selected>Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" id="recurringEndDate">
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Transaction</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeTransactionModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Goal Modal -->
    <div class="modal" id="goalModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Savings Goal</h2>
                <button class="modal-close" onclick="app.closeGoalModal()">Ã—</button>
            </div>
            <form id="goalForm" onsubmit="app.saveGoal(event)">
                <input type="hidden" id="goalId">

                <div class="form-group">
                    <label>Goal Name *</label>
                    <input type="text" id="goalName" placeholder="e.g., Emergency Fund" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Target Amount *</label>
                        <input type="number" id="goalTarget" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Current Amount</label>
                        <input type="number" id="goalCurrent" step="0.01" min="0" value="0">
                    </div>
                </div>

                <div class="form-group">
                    <label>Target Date</label>
                    <input type="date" id="goalDate">
                </div>

                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Goal</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeGoalModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Budget Modal -->
    <div class="modal" id="budgetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set Category Budget</h2>
                <button class="modal-close" onclick="app.closeBudgetModal()">Ã—</button>
            </div>
            <form id="budgetForm" onsubmit="app.saveBudget(event)">
                <div class="form-group">
                    <label>Category *</label>
                    <select id="budgetCategory" required></select>
                </div>

                <div class="form-group">
                    <label>Monthly Budget *</label>
                    <input type="number" id="budgetAmount" step="0.01" min="0" required>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Budget</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeBudgetModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Categories with icons
        const CATEGORIES = {
            expense: [
                { id: 'food', name: 'Food', icon: 'ðŸ”', color: '#ef4444' },
                { id: 'transport', name: 'Transport', icon: 'ðŸš—', color: '#f59e0b' },
                { id: 'shopping', name: 'Shopping', icon: 'ðŸ›ï¸', color: '#ec4899' },
                { id: 'entertainment', name: 'Entertainment', icon: 'ðŸŽ¬', color: '#8b5cf6' },
                { id: 'bills', name: 'Bills', icon: 'ðŸ“„', color: '#6366f1' },
                { id: 'health', name: 'Health', icon: 'ðŸ¥', color: '#10b981' },
                { id: 'education', name: 'Education', icon: 'ðŸ“š', color: '#3b82f6' },
                { id: 'travel', name: 'Travel', icon: 'âœˆï¸', color: '#06b6d4' },
                { id: 'other', name: 'Other', icon: 'ðŸ“¦', color: '#64748b' }
            ],
            income: [
                { id: 'salary', name: 'Salary', icon: 'ðŸ’¼', color: '#10b981' },
                { id: 'freelance', name: 'Freelance', icon: 'ðŸ’»', color: '#06b6d4' },
                { id: 'investment', name: 'Investment', icon: 'ðŸ“ˆ', color: '#8b5cf6' },
                { id: 'gift', name: 'Gift', icon: 'ðŸŽ', color: '#ec4899' },
                { id: 'other-income', name: 'Other', icon: 'ðŸ’°', color: '#64748b' }
            ]
        };

        // Currency symbols
        const CURRENCY_SYMBOLS = {
            USD: '$', EUR: 'â‚¬', GBP: 'Â£', JPY: 'Â¥', INR: 'â‚¹', CAD: '$', AUD: '$'
        };

        // Main App
        class BudgetTrackerApp {
            constructor() {
                this.transactions = [];
                this.goals = [];
                this.budgets = {};
                this.currency = 'USD';
                this.theme = 'light';
                this.selectedCategory = null;
                this.editingTransactionId = null;
                this.editingGoalId = null;

                this.init();
            }

            init() {
                this.loadData();
                this.setupEventListeners();
                this.updateCategoryOptions();
                this.render();
                this.processRecurringTransactions();

                // Set today's date as default
                document.getElementById('transactionDate').valueAsDate = new Date();
            }

            setupEventListeners() {
                // Currency change
                document.getElementById('currencySelect').addEventListener('change', (e) => {
                    this.currency = e.target.value;
                    this.saveData();
                    this.render();
                });

                // Recurring checkbox
                document.getElementById('transactionRecurring').addEventListener('change', (e) => {
                    document.getElementById('recurringOptions').style.display =
                        e.target.checked ? 'block' : 'none';
                });

                // Type selection styling
                document.querySelectorAll('.type-option').forEach(label => {
                    label.addEventListener('click', function() {
                        document.querySelectorAll('.type-option').forEach(l => {
                            l.style.borderColor = 'var(--border)';
                            l.style.background = 'transparent';
                        });
                        this.style.borderColor = 'var(--primary)';
                        this.style.background = 'rgba(99, 102, 241, 0.1)';
                    });
                });
            }

            loadData() {
                const data = localStorage.getItem('budgetTrackerData');
                if (data) {
                    const parsed = JSON.parse(data);
                    this.transactions = parsed.transactions || [];
                    this.goals = parsed.goals || [];
                    this.budgets = parsed.budgets || {};
                    this.currency = parsed.currency || 'USD';
                    this.theme = parsed.theme || 'light';

                    document.getElementById('currencySelect').value = this.currency;
                    if (this.theme === 'dark') {
                        document.documentElement.setAttribute('data-theme', 'dark');
                    }
                }
            }

            saveData() {
                const data = {
                    transactions: this.transactions,
                    goals: this.goals,
                    budgets: this.budgets,
                    currency: this.currency,
                    theme: this.theme
                };
                localStorage.setItem('budgetTrackerData', JSON.stringify(data));
            }

            toggleTheme() {
                this.theme = this.theme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', this.theme);
                this.saveData();
            }

            switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // Update tab content
                document.getElementById('transactionsTab').style.display = 'none';
                document.getElementById('analyticsTab').style.display = 'none';
                document.getElementById('budgetTab').style.display = 'none';
                document.getElementById(`${tabName}Tab`).style.display = 'block';

                // Render charts if switching to analytics
                if (tabName === 'analytics') {
                    setTimeout(() => {
                        this.renderCategoryChart();
                        this.renderTrendChart();
                        this.updateAnalyticsStats();
                    }, 100);
                } else if (tabName === 'budget') {
                    this.renderBudgetList();
                }
            }

            formatCurrency(amount) {
                const symbol = CURRENCY_SYMBOLS[this.currency];
                return `${symbol}${Math.abs(amount).toFixed(2)}`;
            }

            getCategoryById(id, type) {
                const categories = CATEGORIES[type];
                return categories.find(cat => cat.id === id) || categories[categories.length - 1];
            }

            updateCategoryOptions() {
                const type = document.querySelector('input[name="type"]:checked').value;
                const grid = document.getElementById('categoryGrid');
                const categories = CATEGORIES[type];

                grid.innerHTML = categories.map(cat => `
                    <div class="category-item ${this.selectedCategory === cat.id ? 'selected' : ''}"
                         onclick="app.selectCategory('${cat.id}')">
                        <div class="icon">${cat.icon}</div>
                        <div class="name">${cat.name}</div>
                    </div>
                `).join('');

                if (!this.selectedCategory || !categories.find(c => c.id === this.selectedCategory)) {
                    this.selectedCategory = categories[0].id;
                    this.updateCategoryOptions();
                }

                // Update budget category dropdown
                const budgetCategorySelect = document.getElementById('budgetCategory');
                if (budgetCategorySelect) {
                    budgetCategorySelect.innerHTML = CATEGORIES.expense.map(cat =>
                        `<option value="${cat.id}">${cat.icon} ${cat.name}</option>`
                    ).join('');
                }

                // Update category filter
                const categoryFilter = document.getElementById('categoryFilter');
                categoryFilter.innerHTML = '<option value="">All Categories</option>' +
                    [...CATEGORIES.expense, ...CATEGORIES.income].map(cat =>
                        `<option value="${cat.id}">${cat.icon} ${cat.name}</option>`
                    ).join('');
            }

            selectCategory(categoryId) {
                this.selectedCategory = categoryId;
                this.updateCategoryOptions();
            }

            openTransactionModal(transactionId = null) {
                this.editingTransactionId = transactionId;
                const modal = document.getElementById('transactionModal');
                const form = document.getElementById('transactionForm');

                if (transactionId) {
                    const transaction = this.transactions.find(t => t.id === transactionId);
                    if (transaction) {
                        document.getElementById('transactionModalTitle').textContent = 'Edit Transaction';
                        document.getElementById('transactionId').value = transaction.id;
                        document.getElementById('transactionAmount').value = transaction.amount;
                        document.getElementById('transactionDate').value = transaction.date;
                        document.getElementById('transactionDescription').value = transaction.description || '';
                        document.getElementById('transactionNotes').value = transaction.notes || '';
                        document.querySelector(`input[name="type"][value="${transaction.type}"]`).checked = true;
                        this.selectedCategory = transaction.category;

                        if (transaction.recurring) {
                            document.getElementById('transactionRecurring').checked = true;
                            document.getElementById('recurringOptions').style.display = 'block';
                            document.getElementById('recurringFrequency').value = transaction.recurring.frequency;
                            document.getElementById('recurringEndDate').value = transaction.recurring.endDate || '';
                        }

                        this.updateCategoryOptions();
                    }
                } else {
                    document.getElementById('transactionModalTitle').textContent = 'Add Transaction';
                    form.reset();
                    document.getElementById('transactionDate').valueAsDate = new Date();
                    document.getElementById('recurringOptions').style.display = 'none';
                    this.selectedCategory = null;
                    this.updateCategoryOptions();
                }

                modal.classList.add('active');
            }

            closeTransactionModal() {
                document.getElementById('transactionModal').classList.remove('active');
                this.editingTransactionId = null;
            }

            saveTransaction(event) {
                event.preventDefault();

                const type = document.querySelector('input[name="type"]:checked').value;
                const amount = parseFloat(document.getElementById('transactionAmount').value);
                const date = document.getElementById('transactionDate').value;
                const description = document.getElementById('transactionDescription').value;
                const notes = document.getElementById('transactionNotes').value;
                const isRecurring = document.getElementById('transactionRecurring').checked;

                const transaction = {
                    id: this.editingTransactionId || Date.now().toString(),
                    type,
                    amount,
                    date,
                    category: this.selectedCategory,
                    description,
                    notes,
                    createdAt: this.editingTransactionId ?
                        this.transactions.find(t => t.id === this.editingTransactionId).createdAt :
                        new Date().toISOString()
                };

                if (isRecurring) {
                    transaction.recurring = {
                        frequency: document.getElementById('recurringFrequency').value,
                        endDate: document.getElementById('recurringEndDate').value,
                        lastProcessed: date
                    };
                }

                if (this.editingTransactionId) {
                    const index = this.transactions.findIndex(t => t.id === this.editingTransactionId);
                    this.transactions[index] = transaction;
                } else {
                    this.transactions.unshift(transaction);
                }

                this.saveData();
                this.render();
                this.closeTransactionModal();
            }

            deleteTransaction(id) {
                if (confirm('Are you sure you want to delete this transaction?')) {
                    this.transactions = this.transactions.filter(t => t.id !== id);
                    this.saveData();
                    this.render();
                }
            }

            processRecurringTransactions() {
                const today = new Date().toISOString().split('T')[0];
                let hasNewTransactions = false;

                this.transactions.forEach(transaction => {
                    if (!transaction.recurring) return;

                    const lastProcessed = new Date(transaction.recurring.lastProcessed);
                    const currentDate = new Date(today);
                    const endDate = transaction.recurring.endDate ?
                        new Date(transaction.recurring.endDate) : null;

                    if (endDate && currentDate > endDate) return;

                    let shouldCreate = false;
                    let nextDate = new Date(lastProcessed);

                    switch (transaction.recurring.frequency) {
                        case 'daily':
                            nextDate.setDate(nextDate.getDate() + 1);
                            shouldCreate = nextDate <= currentDate;
                            break;
                        case 'weekly':
                            nextDate.setDate(nextDate.getDate() + 7);
                            shouldCreate = nextDate <= currentDate;
                            break;
                        case 'monthly':
                            nextDate.setMonth(nextDate.getMonth() + 1);
                            shouldCreate = nextDate <= currentDate;
                            break;
                        case 'yearly':
                            nextDate.setFullYear(nextDate.getFullYear() + 1);
                            shouldCreate = nextDate <= currentDate;
                            break;
                    }

                    if (shouldCreate) {
                        const newTransaction = {
                            ...transaction,
                            id: Date.now().toString() + Math.random(),
                            date: today,
                            createdAt: new Date().toISOString()
                        };
                        newTransaction.recurring.lastProcessed = today;

                        this.transactions.unshift(newTransaction);
                        transaction.recurring.lastProcessed = today;
                        hasNewTransactions = true;
                    }
                });

                if (hasNewTransactions) {
                    this.saveData();
                }
            }

            openGoalModal(goalId = null) {
                this.editingGoalId = goalId;
                const modal = document.getElementById('goalModal');
                const form = document.getElementById('goalForm');

                if (goalId) {
                    const goal = this.goals.find(g => g.id === goalId);
                    if (goal) {
                        document.getElementById('goalId').value = goal.id;
                        document.getElementById('goalName').value = goal.name;
                        document.getElementById('goalTarget').value = goal.target;
                        document.getElementById('goalCurrent').value = goal.current;
                        document.getElementById('goalDate').value = goal.date || '';
                    }
                } else {
                    form.reset();
                }

                modal.classList.add('active');
            }

            closeGoalModal() {
                document.getElementById('goalModal').classList.remove('active');
                this.editingGoalId = null;
            }

            saveGoal(event) {
                event.preventDefault();

                const name = document.getElementById('goalName').value;
                const target = parseFloat(document.getElementById('goalTarget').value);
                const current = parseFloat(document.getElementById('goalCurrent').value);
                const date = document.getElementById('goalDate').value;

                const goal = {
                    id: this.editingGoalId || Date.now().toString(),
                    name,
                    target,
                    current,
                    date
                };

                if (this.editingGoalId) {
                    const index = this.goals.findIndex(g => g.id === this.editingGoalId);
                    this.goals[index] = goal;
                } else {
                    this.goals.push(goal);
                }

                this.saveData();
                this.renderGoals();
                this.closeGoalModal();
            }

            deleteGoal(id) {
                if (confirm('Are you sure you want to delete this goal?')) {
                    this.goals = this.goals.filter(g => g.id !== id);
                    this.saveData();
                    this.renderGoals();
                }
            }

            openBudgetModal() {
                document.getElementById('budgetModal').classList.add('active');
            }

            closeBudgetModal() {
                document.getElementById('budgetModal').classList.remove('active');
            }

            saveBudget(event) {
                event.preventDefault();

                const category = document.getElementById('budgetCategory').value;
                const amount = parseFloat(document.getElementById('budgetAmount').value);

                this.budgets[category] = amount;
                this.saveData();
                this.renderBudgetList();
                this.closeBudgetModal();
            }

            filterTransactions() {
                const search = document.getElementById('searchInput').value.toLowerCase();
                const category = document.getElementById('categoryFilter').value;
                const type = document.getElementById('typeFilter').value;
                const period = document.getElementById('periodFilter').value;

                let filtered = this.transactions.filter(t => {
                    const matchesSearch = !search ||
                        t.description?.toLowerCase().includes(search) ||
                        t.notes?.toLowerCase().includes(search);
                    const matchesCategory = !category || t.category === category;
                    const matchesType = !type || t.type === type;

                    let matchesPeriod = true;
                    if (period !== 'all') {
                        const transactionDate = new Date(t.date);
                        const today = new Date();

                        switch (period) {
                            case 'today':
                                matchesPeriod = transactionDate.toDateString() === today.toDateString();
                                break;
                            case 'week':
                                const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                                matchesPeriod = transactionDate >= weekAgo;
                                break;
                            case 'month':
                                matchesPeriod = transactionDate.getMonth() === today.getMonth() &&
                                              transactionDate.getFullYear() === today.getFullYear();
                                break;
                            case 'year':
                                matchesPeriod = transactionDate.getFullYear() === today.getFullYear();
                                break;
                        }
                    }

                    return matchesSearch && matchesCategory && matchesType && matchesPeriod;
                });

                this.renderTransactions(filtered);
            }

            renderTransactions(transactions = this.transactions) {
                const container = document.getElementById('transactionList');

                if (transactions.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ðŸ’³</div>
                            <h3>No transactions yet</h3>
                            <p>Start tracking your finances by adding your first transaction</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = transactions.map(t => {
                    const category = this.getCategoryById(t.category, t.type);
                    const date = new Date(t.date);
                    const formattedDate = date.toLocaleDateString('en-US', {
                        month: 'short', day: 'numeric', year: 'numeric'
                    });

                    return `
                        <div class="transaction-item" onclick="app.openTransactionModal('${t.id}')">
                            <div class="transaction-icon ${t.type}">
                                ${category.icon}
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-category">
                                    ${category.name}
                                    ${t.recurring ? '<span class="badge badge-recurring">Recurring</span>' : ''}
                                </div>
                                <div class="transaction-description">
                                    ${t.description || 'No description'}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="transaction-amount ${t.type}">
                                    ${t.type === 'income' ? '+' : '-'}${this.formatCurrency(t.amount)}
                                </div>
                                <div class="transaction-date">${formattedDate}</div>
                            </div>
                            <div class="transaction-actions" onclick="event.stopPropagation()">
                                <button onclick="app.deleteTransaction('${t.id}')">ðŸ—‘ï¸</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            calculateStats() {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
                const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;

                // Current month
                const currentMonthTransactions = this.transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
                });

                // Last month
                const lastMonthTransactions = this.transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getMonth() === lastMonth && date.getFullYear() === lastMonthYear;
                });

                const currentIncome = currentMonthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);

                const currentExpenses = currentMonthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);

                const lastIncome = lastMonthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);

                const lastExpenses = lastMonthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);

                const totalIncome = this.transactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);

                const totalExpenses = this.transactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);

                const balance = totalIncome - totalExpenses;

                return {
                    balance,
                    currentIncome,
                    currentExpenses,
                    lastIncome,
                    lastExpenses,
                    incomeTrend: this.calculateTrend(currentIncome, lastIncome),
                    expensesTrend: this.calculateTrend(currentExpenses, lastExpenses),
                    balanceTrend: this.calculateTrend(currentIncome - currentExpenses, lastIncome - lastExpenses)
                };
            }

            calculateTrend(current, previous) {
                if (previous === 0) return { value: 0, direction: 'neutral' };
                const change = ((current - previous) / previous) * 100;
                return {
                    value: Math.abs(change).toFixed(1),
                    direction: change > 0 ? 'up' : change < 0 ? 'down' : 'neutral'
                };
            }

            calculateFinancialHealth() {
                const stats = this.calculateStats();
                let score = 50; // Base score

                // Income vs Expenses (30 points)
                if (stats.currentIncome > 0) {
                    const ratio = stats.currentExpenses / stats.currentIncome;
                    if (ratio < 0.5) score += 30;
                    else if (ratio < 0.7) score += 20;
                    else if (ratio < 0.9) score += 10;
                    else if (ratio < 1) score += 5;
                    else score -= 10;
                }

                // Savings (20 points)
                if (stats.balance > 0) {
                    if (stats.balance > stats.currentIncome * 3) score += 20;
                    else if (stats.balance > stats.currentIncome) score += 10;
                    else score += 5;
                }

                // Trend (20 points)
                if (stats.incomeTrend.direction === 'up') score += 10;
                if (stats.expensesTrend.direction === 'down') score += 10;

                // Budget adherence (10 points)
                let budgetScore = 0;
                Object.keys(this.budgets).forEach(category => {
                    const spent = this.getMonthlySpendingByCategory()[category] || 0;
                    const budget = this.budgets[category];
                    if (spent <= budget) budgetScore += 1;
                });
                score += Math.min(budgetScore * 2, 10);

                return Math.max(0, Math.min(100, score));
            }

            getHealthLabel(score) {
                if (score >= 80) return 'ðŸ’ª Excellent';
                if (score >= 60) return 'ðŸ‘ Good';
                if (score >= 40) return 'âš ï¸ Fair';
                return 'ðŸ”´ Needs Improvement';
            }

            renderDashboard() {
                const stats = this.calculateStats();
                const healthScore = this.calculateFinancialHealth();

                document.getElementById('totalBalance').textContent = this.formatCurrency(stats.balance);
                document.getElementById('totalBalance').className =
                    `card-value ${stats.balance >= 0 ? 'positive' : 'negative'}`;

                document.getElementById('monthlyIncome').textContent = this.formatCurrency(stats.currentIncome);
                document.getElementById('monthlyExpenses').textContent = this.formatCurrency(stats.currentExpenses);

                document.getElementById('balanceTrend').innerHTML = stats.balanceTrend.value > 0 ?
                    `<span class="trend ${stats.balanceTrend.direction}">${stats.balanceTrend.direction === 'up' ? 'â†‘' : 'â†“'} ${stats.balanceTrend.value}% vs last month</span>` : '';

                document.getElementById('incomeTrend').innerHTML = stats.incomeTrend.value > 0 ?
                    `<span class="trend ${stats.incomeTrend.direction}">${stats.incomeTrend.direction === 'up' ? 'â†‘' : 'â†“'} ${stats.incomeTrend.value}% vs last month</span>` : '';

                document.getElementById('expensesTrend').innerHTML = stats.expensesTrend.value > 0 ?
                    `<span class="trend ${stats.expensesTrend.direction === 'up' ? 'down' : 'up'}">${stats.expensesTrend.direction === 'up' ? 'â†‘' : 'â†“'} ${stats.expensesTrend.value}% vs last month</span>` : '';

                document.getElementById('healthScore').textContent = healthScore;
                document.getElementById('healthLabel').textContent = this.getHealthLabel(healthScore);
            }

            generateInsights() {
                const insights = [];
                const stats = this.calculateStats();
                const monthlySpending = this.getMonthlySpendingByCategory();

                // Budget alerts
                Object.keys(this.budgets).forEach(category => {
                    const spent = monthlySpending[category] || 0;
                    const budget = this.budgets[category];
                    const percentage = (spent / budget) * 100;

                    if (percentage > 100) {
                        insights.push({
                            type: 'danger',
                            icon: 'ðŸš¨',
                            title: 'Budget Exceeded',
                            message: `You've exceeded your ${this.getCategoryById(category, 'expense').name} budget by ${this.formatCurrency(spent - budget)} (${percentage.toFixed(0)}%)`
                        });
                    } else if (percentage > 80) {
                        insights.push({
                            type: 'warning',
                            icon: 'âš ï¸',
                            title: 'Approaching Budget Limit',
                            message: `You've used ${percentage.toFixed(0)}% of your ${this.getCategoryById(category, 'expense').name} budget`
                        });
                    }
                });

                // Spending patterns
                const topCategory = Object.entries(monthlySpending)
                    .sort((a, b) => b[1] - a[1])[0];

                if (topCategory && topCategory[1] > 0) {
                    const categoryName = this.getCategoryById(topCategory[0], 'expense').name;
                    const percentage = (topCategory[1] / stats.currentExpenses * 100).toFixed(0);
                    insights.push({
                        type: 'info',
                        icon: 'ðŸ“Š',
                        title: 'Top Spending Category',
                        message: `${categoryName} accounts for ${percentage}% of your monthly spending (${this.formatCurrency(topCategory[1])})`
                    });
                }

                // Savings opportunities
                if (stats.currentIncome > stats.currentExpenses) {
                    const savingsPotential = stats.currentIncome - stats.currentExpenses;
                    insights.push({
                        type: 'success',
                        icon: 'ðŸ’°',
                        title: 'Great Job!',
                        message: `You're saving ${this.formatCurrency(savingsPotential)} this month. Keep it up!`
                    });
                } else if (stats.currentExpenses > stats.currentIncome) {
                    const deficit = stats.currentExpenses - stats.currentIncome;
                    insights.push({
                        type: 'danger',
                        icon: 'âš ï¸',
                        title: 'Spending Alert',
                        message: `Your expenses exceed income by ${this.formatCurrency(deficit)}. Consider reducing discretionary spending.`
                    });
                }

                // Trend insights
                if (stats.expensesTrend.direction === 'up' && parseFloat(stats.expensesTrend.value) > 10) {
                    insights.push({
                        type: 'warning',
                        icon: 'ðŸ“ˆ',
                        title: 'Expenses Increasing',
                        message: `Your expenses increased by ${stats.expensesTrend.value}% compared to last month. Review your spending.`
                    });
                }

                // Goal progress
                this.goals.forEach(goal => {
                    const progress = (goal.current / goal.target) * 100;
                    if (progress >= 100) {
                        insights.push({
                            type: 'success',
                            icon: 'ðŸŽ‰',
                            title: 'Goal Achieved!',
                            message: `Congratulations! You've reached your "${goal.name}" goal!`
                        });
                    } else if (progress >= 75) {
                        insights.push({
                            type: 'success',
                            icon: 'ðŸŽ¯',
                            title: 'Almost There!',
                            message: `You're ${progress.toFixed(0)}% of the way to your "${goal.name}" goal. Only ${this.formatCurrency(goal.target - goal.current)} to go!`
                        });
                    }
                });

                return insights;
            }

            renderInsights() {
                const container = document.getElementById('insightsPanel');
                const insights = this.generateInsights();

                if (insights.length === 0) {
                    container.innerHTML = `
                        <div class="insight-card">
                            <h4>ðŸ¤– AI Analysis</h4>
                            <p>Add more transactions to get personalized insights and recommendations.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = insights.slice(0, 5).map(insight => `
                    <div class="insight-card ${insight.type}">
                        <h4>${insight.icon} ${insight.title}</h4>
                        <p>${insight.message}</p>
                    </div>
                `).join('');
            }

            renderAlerts() {
                const container = document.getElementById('alertsContainer');
                const alerts = [];
                const monthlySpending = this.getMonthlySpendingByCategory();

                // Critical budget alerts
                Object.keys(this.budgets).forEach(category => {
                    const spent = monthlySpending[category] || 0;
                    const budget = this.budgets[category];
                    const percentage = (spent / budget) * 100;

                    if (percentage > 100) {
                        alerts.push({
                            type: 'danger',
                            icon: 'ðŸš¨',
                            title: 'Budget Alert',
                            message: `${this.getCategoryById(category, 'expense').name} budget exceeded by ${this.formatCurrency(spent - budget)}`
                        });
                    }
                });

                container.innerHTML = alerts.map(alert => `
                    <div class="alert alert-${alert.type}">
                        <div class="alert-icon">${alert.icon}</div>
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-message">${alert.message}</div>
                        </div>
                    </div>
                `).join('');
            }

            generatePredictions() {
                const predictions = [];

                // Get last 3 months spending
                const now = new Date();
                const monthlyTotals = [];

                for (let i = 0; i < 3; i++) {
                    const month = now.getMonth() - i;
                    const year = now.getFullYear() - (month < 0 ? 1 : 0);
                    const adjustedMonth = month < 0 ? 12 + month : month;

                    const total = this.transactions
                        .filter(t => {
                            const date = new Date(t.date);
                            return t.type === 'expense' &&
                                   date.getMonth() === adjustedMonth &&
                                   date.getFullYear() === year;
                        })
                        .reduce((sum, t) => sum + t.amount, 0);

                    monthlyTotals.push(total);
                }

                if (monthlyTotals.length >= 2) {
                    const avg = monthlyTotals.reduce((a, b) => a + b, 0) / monthlyTotals.length;
                    const trend = monthlyTotals[0] - monthlyTotals[monthlyTotals.length - 1];
                    const nextMonth = avg + (trend / monthlyTotals.length);

                    predictions.push({
                        title: 'Next Month Forecast',
                        value: this.formatCurrency(nextMonth),
                        description: `Based on your spending patterns, we predict you'll spend approximately ${this.formatCurrency(nextMonth)} next month.`
                    });

                    // Year-end prediction
                    const monthsRemaining = 12 - now.getMonth();
                    const yearEndTotal = this.transactions
                        .filter(t => {
                            const date = new Date(t.date);
                            return t.type === 'expense' && date.getFullYear() === now.getFullYear();
                        })
                        .reduce((sum, t) => sum + t.amount, 0);

                    const yearEndProjection = yearEndTotal + (nextMonth * monthsRemaining);

                    predictions.push({
                        title: 'Year-End Projection',
                        value: this.formatCurrency(yearEndProjection),
                        description: `At this rate, you'll spend ${this.formatCurrency(yearEndProjection)} by the end of the year.`
                    });
                }

                return predictions;
            }

            renderPredictions() {
                const container = document.getElementById('predictionsPanel');
                const predictions = this.generatePredictions();

                if (predictions.length === 0) {
                    container.innerHTML = `
                        <p style="color: var(--text-secondary); font-size: 13px; text-align: center; padding: 20px;">
                            Add more transactions over time to see spending predictions.
                        </p>
                    `;
                    return;
                }

                container.innerHTML = predictions.map(pred => `
                    <div style="padding: 15px; background: var(--bg-primary); border-radius: 10px; margin-bottom: 15px;">
                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px;">
                            ${pred.title}
                        </div>
                        <div style="font-size: 24px; font-weight: 700; margin-bottom: 8px; color: var(--primary);">
                            ${pred.value}
                        </div>
                        <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.5;">
                            ${pred.description}
                        </div>
                    </div>
                `).join('');
            }

            renderGoals() {
                const container = document.getElementById('goalsList');

                if (this.goals.length === 0) {
                    container.innerHTML = `
                        <p style="color: var(--text-secondary); font-size: 13px; text-align: center; padding: 20px;">
                            No savings goals yet. Create one to start tracking your progress!
                        </p>
                    `;
                    return;
                }

                container.innerHTML = this.goals.map(goal => {
                    const progress = Math.min((goal.current / goal.target) * 100, 100);
                    const remaining = Math.max(goal.target - goal.current, 0);

                    return `
                        <div class="goal-item">
                            <div class="goal-header">
                                <div class="goal-name">${goal.name}</div>
                                <div class="goal-amount">${this.formatCurrency(goal.current)} / ${this.formatCurrency(goal.target)}</div>
                            </div>
                            <div class="goal-progress">
                                <div class="goal-progress-bar" style="width: ${progress}%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="goal-percentage">${progress.toFixed(0)}% complete</div>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-secondary btn-sm" onclick="app.openGoalModal('${goal.id}')">Edit</button>
                                    <button class="btn btn-danger btn-sm" onclick="app.deleteGoal('${goal.id}')">Delete</button>
                                </div>
                            </div>
                            ${goal.date ? `<div style="font-size: 11px; color: var(--text-secondary); margin-top: 8px;">Target: ${new Date(goal.date).toLocaleDateString()}</div>` : ''}
                        </div>
                    `;
                }).join('');
            }

            getMonthlySpendingByCategory() {
                const now = new Date();
                const spending = {};

                this.transactions
                    .filter(t => {
                        const date = new Date(t.date);
                        return t.type === 'expense' &&
                               date.getMonth() === now.getMonth() &&
                               date.getFullYear() === now.getFullYear();
                    })
                    .forEach(t => {
                        spending[t.category] = (spending[t.category] || 0) + t.amount;
                    });

                return spending;
            }

            renderBudgetList() {
                const container = document.getElementById('budgetList');
                const spending = this.getMonthlySpendingByCategory();

                if (Object.keys(this.budgets).length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ðŸŽ¯</div>
                            <h3>No budgets set</h3>
                            <p>Set budgets for different categories to track your spending</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = Object.entries(this.budgets).map(([categoryId, budget]) => {
                    const category = this.getCategoryById(categoryId, 'expense');
                    const spent = spending[categoryId] || 0;
                    const percentage = Math.min((spent / budget) * 100, 100);
                    const remaining = Math.max(budget - spent, 0);
                    const status = percentage > 100 ? 'danger' : percentage > 80 ? 'warning' : 'success';

                    return `
                        <div style="padding: 20px; background: var(--bg-primary); border-radius: 12px; margin-bottom: 15px; border: 1px solid var(--border);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 24px;">${category.icon}</span>
                                    <div>
                                        <div style="font-weight: 600; font-size: 15px;">${category.name}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">
                                            ${this.formatCurrency(spent)} of ${this.formatCurrency(budget)}
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 18px; font-weight: 700; color: var(--${status});">
                                        ${percentage.toFixed(0)}%
                                    </div>
                                    <div style="font-size: 11px; color: var(--text-secondary);">
                                        ${this.formatCurrency(remaining)} left
                                    </div>
                                </div>
                            </div>
                            <div class="goal-progress">
                                <div class="goal-progress-bar" style="width: ${percentage}%; background: var(--${status});"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderCategoryChart() {
                const canvas = document.getElementById('categoryChart');
                const ctx = canvas.getContext('2d');
                const spending = this.getMonthlySpendingByCategory();

                // Set canvas size
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;

                const data = Object.entries(spending).map(([categoryId, amount]) => ({
                    category: this.getCategoryById(categoryId, 'expense'),
                    amount
                })).sort((a, b) => b.amount - a.amount);

                if (data.length === 0) {
                    ctx.fillStyle = 'var(--text-secondary)';
                    ctx.font = '14px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('No expense data for this month', canvas.width / 2, canvas.height / 2);
                    return;
                }

                const total = data.reduce((sum, item) => sum + item.amount, 0);
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = Math.min(centerX, centerY) - 20;
                const innerRadius = radius * 0.6; // Donut chart

                let startAngle = -Math.PI / 2;

                data.forEach((item, index) => {
                    const sliceAngle = (item.amount / total) * 2 * Math.PI;
                    const endAngle = startAngle + sliceAngle;

                    // Draw slice
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                    ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);
                    ctx.closePath();
                    ctx.fillStyle = item.category.color;
                    ctx.fill();

                    // Draw label
                    if (sliceAngle > 0.1) {
                        const labelAngle = startAngle + sliceAngle / 2;
                        const labelRadius = radius + 30;
                        const labelX = centerX + Math.cos(labelAngle) * labelRadius;
                        const labelY = centerY + Math.sin(labelAngle) * labelRadius;

                        ctx.fillStyle = 'var(--text-primary)';
                        ctx.font = '12px sans-serif';
                        ctx.textAlign = labelX > centerX ? 'left' : 'right';
                        ctx.fillText(`${((item.amount / total) * 100).toFixed(0)}%`, labelX, labelY);
                    }

                    startAngle = endAngle;
                });

                // Draw center text
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = 'bold 20px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.formatCurrency(total), centerX, centerY);
                ctx.font = '12px sans-serif';
                ctx.fillStyle = 'var(--text-secondary)';
                ctx.fillText('Total Expenses', centerX, centerY + 25);

                // Render legend
                const legendContainer = document.getElementById('categoryLegend');
                legendContainer.innerHTML = data.map(item => `
                    <div class="legend-item">
                        <div class="legend-color" style="background: ${item.category.color};"></div>
                        <span>${item.category.icon} ${item.category.name}</span>
                    </div>
                `).join('');
            }

            renderTrendChart() {
                const canvas = document.getElementById('trendChart');
                const ctx = canvas.getContext('2d');

                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;

                // Get last 6 months data
                const now = new Date();
                const monthsData = [];

                for (let i = 5; i >= 0; i--) {
                    const month = now.getMonth() - i;
                    const year = now.getFullYear() - (month < 0 ? 1 : 0);
                    const adjustedMonth = month < 0 ? 12 + month : month;

                    const income = this.transactions
                        .filter(t => {
                            const date = new Date(t.date);
                            return t.type === 'income' &&
                                   date.getMonth() === adjustedMonth &&
                                   date.getFullYear() === year;
                        })
                        .reduce((sum, t) => sum + t.amount, 0);

                    const expenses = this.transactions
                        .filter(t => {
                            const date = new Date(t.date);
                            return t.type === 'expense' &&
                                   date.getMonth() === adjustedMonth &&
                                   date.getFullYear() === year;
                        })
                        .reduce((sum, t) => sum + t.amount, 0);

                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    monthsData.push({
                        month: monthNames[adjustedMonth],
                        income,
                        expenses
                    });
                }

                const maxValue = Math.max(
                    ...monthsData.map(d => Math.max(d.income, d.expenses)),
                    1
                );

                const padding = 40;
                const chartWidth = canvas.width - padding * 2;
                const chartHeight = canvas.height - padding * 2;
                const barWidth = chartWidth / (monthsData.length * 2 + 1);

                // Draw grid lines
                ctx.strokeStyle = 'var(--border)';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const y = padding + (chartHeight / 5) * i;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(canvas.width - padding, y);
                    ctx.stroke();

                    // Draw value labels
                    ctx.fillStyle = 'var(--text-secondary)';
                    ctx.font = '10px sans-serif';
                    ctx.textAlign = 'right';
                    const value = maxValue * (1 - i / 5);
                    ctx.fillText(this.formatCurrency(value), padding - 5, y + 3);
                }

                // Draw bars
                monthsData.forEach((data, index) => {
                    const x = padding + (index * 2 + 1) * barWidth;

                    // Income bar
                    const incomeHeight = (data.income / maxValue) * chartHeight;
                    ctx.fillStyle = '#10b981';
                    ctx.fillRect(x, padding + chartHeight - incomeHeight, barWidth * 0.8, incomeHeight);

                    // Expense bar
                    const expenseHeight = (data.expenses / maxValue) * chartHeight;
                    ctx.fillStyle = '#ef4444';
                    ctx.fillRect(x + barWidth, padding + chartHeight - expenseHeight, barWidth * 0.8, expenseHeight);

                    // Month label
                    ctx.fillStyle = 'var(--text-primary)';
                    ctx.font = '11px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(data.month, x + barWidth, canvas.height - padding + 15);
                });

                // Legend
                ctx.fillStyle = '#10b981';
                ctx.fillRect(padding, padding - 25, 15, 15);
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('Income', padding + 20, padding - 13);

                ctx.fillStyle = '#ef4444';
                ctx.fillRect(padding + 90, padding - 25, 15, 15);
                ctx.fillText('Expenses', padding + 110, padding - 13);
            }

            updateAnalyticsStats() {
                const now = new Date();
                const monthTransactions = this.transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getMonth() === now.getMonth() &&
                           date.getFullYear() === now.getFullYear();
                });

                const expenses = monthTransactions.filter(t => t.type === 'expense');
                const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0);

                const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                const avgDaily = totalExpenses / now.getDate();

                const largest = expenses.length > 0 ?
                    Math.max(...expenses.map(t => t.amount)) : 0;

                const spending = this.getMonthlySpendingByCategory();
                const topCat = Object.entries(spending)
                    .sort((a, b) => b[1] - a[1])[0];

                document.getElementById('avgDailySpending').textContent = this.formatCurrency(avgDaily);
                document.getElementById('largestExpense').textContent = this.formatCurrency(largest);
                document.getElementById('transactionCount').textContent = this.transactions.length;
                document.getElementById('topCategory').textContent = topCat ?
                    this.getCategoryById(topCat[0], 'expense').name : '--';
            }

            exportToCSV() {
                const headers = ['Date', 'Type', 'Category', 'Amount', 'Description', 'Notes'];
                const rows = this.transactions.map(t => {
                    const category = this.getCategoryById(t.category, t.type);
                    return [
                        t.date,
                        t.type,
                        category.name,
                        t.amount,
                        t.description || '',
                        t.notes || ''
                    ];
                });

                const csv = [
                    headers.join(','),
                    ...rows.map(row => row.map(cell =>
                        typeof cell === 'string' && cell.includes(',') ? `"${cell}"` : cell
                    ).join(','))
                ].join('\n');

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `budget-tracker-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            }

            render() {
                this.renderDashboard();
                this.filterTransactions();
                this.renderInsights();
                this.renderAlerts();
                this.renderPredictions();
                this.renderGoals();
            }
        }

        // Initialize app
        const app = new BudgetTrackerApp();
    </script>
</body>
</html>